<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE properties SYSTEM "http://java.sun.com/dtd/properties.dtd">
<properties>
	<!-- 페이징 하기위해 리스트 갯수 조회 구문 [용훈]  --> 
	<entry key="selectListCount">
		SELECT COUNT(*) "COUNT"
		FROM MOVIE M
		LEFT JOIN MOVIE_CATEGORY C ON (M.MV_NO = C.MV_NO)
		WHERE MV_STATUS = 'Y'
	</entry>
	
	<!--  탐색페이지 필터 활용 구문 [용훈] -->
	<entry key="selectExploList">
		SELECT DISTINCT M.MV_NO
            , MV_POSTER
            , MV_NAME
            , (SELECT ROUND(AVG(LIKE_POINT), 1) FROM REVIEW WHERE MV_NO = M.MV_NO) "LIKE_POINT"
            , MV_OPENDATE
            , (SELECT COUNT(*) FROM MOVIE_LIKE WHERE MV_NO = M.MV_NO) "LIKECOUNT"
            , (SELECT COUNT(*) FROM REVIEW WHERE MV_NO = M.MV_NO) "REVIEWS"
		FROM MOVIE M
		LEFT JOIN MOVIE_CATEGORY C ON (M.MV_NO = C.MV_NO)
		WHERE MV_STATUS = 'Y'  
	</entry>
	
	<!-- 영화, 인물 검색 시 사용할 구문 [기웅] -->
	<!-- 영화 제목, 개봉연도, 평균별점 조회 -->
	<entry key="selectMovieStarRatingAvg">
		SELECT M.MV_NO AS "MV_NO", MV_NAME, MV_OPENDATE, ROUND(AVG(LIKE_POINT), 1) AS "AVG_LIKE_POINT"
		FROM MOVIE M
		LEFT JOIN REVIEW R
		ON R.MV_NO = M.MV_NO
		WHERE MV_NAME LIKE ?
		AND MV_STATUS = 'Y'
		GROUP BY(M.MV_NO, MV_NAME, MV_OPENDATE)
		ORDER BY MV_NO
	</entry>
	<!-- 영화 포스터 경로 -->
	<entry key="selectMoviePosterPath">
		SELECT MV_POSTER
		FROM MOVIE
		WHERE MV_NAME LIKE ?
		AND MV_STATUS = 'Y'
		ORDER BY MV_NO
	</entry>
	
	<!-- 영화 상세보기를 위한 쿼리 [기웅] -->
	<!-- 영화 상세정보 조회 -->
	<entry key="selectMovieInfo">
		SELECT 
    	M.MV_NO AS "MV_NO", 
    	MV_NAME, 
    	MV_OPENDATE, 
    	MV_RTIME,
    	MV_STORY,
        MV_POSTER,
        MV_PREVIEW,
    	(SELECT ROUND(AVG(LIKE_POINT), 1) FROM REVIEW R WHERE R.MV_NO = M.MV_NO) AS "AVG_STAR_RATING",
    	(SELECT COUNT(*) FROM REVIEW R WHERE R.MV_NO = M.MV_NO) AS "NUMBER_OF_STAR_RATING"
		FROM MOVIE M
		WHERE MV_NO = ?
	</entry>
	<!-- 영화 상세보기에서 영화 추가 파일을 불러오는 쿼리 -->
	<entry key="selectAddiMovie">
	SELECT FILE_NO, FILE_PATH || CHANGE_NAME AS "FILEPATH"
	FROM ATTACHMENT
	JOIN MOVIE
	ON REF_NO = MV_NO
	WHERE MV_NO = ?
	AND FILE_LEVEL = 2
	AND FILE_STATUS = 'Y'
	AND REF_TYPE = 1
	</entry>
</properties>